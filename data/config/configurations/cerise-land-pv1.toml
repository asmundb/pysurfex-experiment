# Start on namelist

[general]
arhive_ecfs = true
ecfs_pattern = "ec:sfx_data/daexp_ml/@YYYY@/"
archive_hours = ["00", "03", "06", "09", "12", "15", "18", "21"]

[initial_conditions]
prep_input_file = ""
prep_pgdfile = ""

[initial_conditions.fg4oi]
inputfile = "@sfx_exp_data@/archive/@YYYY@/@MM@/@DD@/@HH@/SURFOUT.nc"
fileformat = "surfex"

[initial_conditions.fg4oi.altitude]
inputfile = "@sfx_exp_data@/climate/PGD.nc"
converter = "none"
[initial_conditions.fg4oi.surface_snow_thickness]
inputfile = "@sfx_exp_data@/archive/@YYYY@/@MM@/@DD@/@HH@/SURFOUT.@YYYY@@MM@@DD@_@HH_LL@h00.nc"
converter = "none"
[initial_conditions.fg4oi.land_area_fraction]
inputfile = "@sfx_exp_data@/climate/PGD.nc"
converter = "nature_town"

[forecast]
#####################################################################################################
#  Forecast model (physics + dynamics and output)
#####################################################################################################

physics = "arome"
ensmsel = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]          # Ensemble members to run (list with member numbers)

forc_zs = true

[eps]
pert_forcing = true
pert_state = false
tau = 86400
remap_precip = true  

[eps.offline.noise]
correlation_matrix = [ [ 1.0, -0.0663611, 0.177329, 0.09092014, 0.12285594,], [ -0.0663611, 1.0, -0.24639098, -0.06129621, 0.15581132,], [ 0.177329, -0.24639098, 1.0, 0.07822633, 0.49344876,], [ 0.09092014, -0.06129621, 0.07822633, 1.0, -0.12753072,], [ 0.12285594, 0.15581132, 0.49344876, -0.12753072, 1.0,],]
standard_deviation = [ 1.0, 1.0, 1.0, 1.0, 1.0,]
spatial_correlation_length = 160
temporal_correlation_length = 86400

[[eps.offline.noise.variables]]
name = "Rainf"
method = "mul"
coef = 0.5

[[eps.offline.noise.variables]]
name = "DIR_SWdown"
method = "mul"
coef = 0.3

[[eps.offline.noise.variables]]
name = "LWdown"
method = "add"
coef = 30.0

[[eps.offline.noise.variables]]
name = "Snowf"
method = "mul"
coef = 0.5

[[eps.offline.noise.variables]]
name = "Tair"
method = "add"
coef = 0.5


[assim]

[assim.general]
do_assim = true
hofxpath = "@sfx_exp_data@/archive/@YYYY@/@MM@/@DD@/@HH@/@mbr@/SURFOUT.@YYYY_LL@@MM_LL@@DD_LL@_@HH_LL@h00.nc"
obpath = "/hpcperm/fab0/sfx_data/nordic/observations/@YYYY@/@MM@/@DD@/@HH@/newob@YYYY@@MM@@DD@@HH@.json"
station_location_file = "/perm/fab0/projects/cerise/obslocs.json"

[assim.control.observation_vector.T2M]
assimilate = true

[assim.control.observation_vector.DSN_T_ISBA]
assimilate = true

[assim.control.control_vector."WSN_VEG@level@"]
assimilate = true
levels = "1-12"

[assim.control.control_vector."RSN_VEG@level@"]
assimilate = true
levels = "1-12"

[assim.control.control_vector."HSN_VEG@level@"]
assimilate = true
levels = "1-12"

[assim.control.control_vector."SAG_VEG@level@"]
assimilate = false
levels = "1-12"

[assim.control.control_vector.ASN_VEG]
assimilate = false

[assim.control.control_vector."TG@level@"]
assimilate = true
levels = "1-3"

[assim.control.control_vector."WG@level@"]
assimilate = true
levels = "1-5"

[assim.localization]
horizontal_gp = 20
vertical_m = 200

[SURFEX.IO]
CTIMESERIES_FILETYPE = "NC"         # Fileformat for timseries. Inline runs use FA
LSELECT = false                     # Only write selected diagnostics
XTSTEP_OUTPUT = 10800.0             # Output interval from the binary OFFLINE
LSPLIT_PATCH = false                # Split patches into separate variables in output files

 
[SURFEX.COVER]                      # Land cover information
YCOVER = "ecosg_final_map"          # Version of ECOCLIMAP for surfex (1,2,SG)
SG = true                           # ECOCLIMAP second generation

[SURFEX.ISBA]
SCHEME = "DIF"                      # Type of ISBA scheme in SURFEX. Options: "3-L"|"2-L"|"DIF"
MEB = true                          # Enable Multi Energy Budget (MEB) model
SNOW = "3-L"                        # Type of snow scheme in SURFEX. Options: "D95" and "3-L"
YSAND = "SAND_SOILGRID"             # Soil texture input data: "sand_fao.dir"|"SAND_HWSD_MOY_V2.dir"|"sand_SOILGRID.dir"
YCLAY = "CLAY_SOILGRID"             # Soil texture input data: "clay_fao.dir"|"CLAY_HWSD_MOY_V2.dir"|"clay_SOILGRID.dir"

[SURFEX.ASSIM.SCHEMES]
# SEA = "INPUT" not implemented offline yet
SEA = "NONE"                         # Assimilation method for sea tile: "INPUT"|"NONE"
INLAND_WATER = "NONE"               # Assimilation method for water tile: "INPUT"|"NONE"
ISBA = "NONE"                         # Assimilation method for ISBA soil: "NONE"|"OI"|"EKF"
TEB = "NONE"                        # Assimilation method for TEB tile: "NONE"|"ROADT"



[SURFEX.ASSIM.ISBA.EKF]
NNCV = [0,1,0,1]                             # Active EKF control variables
XSIGMA_M = [2.0, 2.0, 0.1 , 0.15]            # Background error
CVAR_M = ["TG1", "TG2", "WG1" , "WG2"]       # Control variables
XTPRT_M = [0.0001, 0.0001, 0.00001, 0.00001] # Perturbation magnitude
LLINCHECK = true

[SURFEX.ASSIM.ISBA]
UPDATE_SNOW_CYCLES = ["06"]          # Cycles to update snow depths/SWE in assimilation.
 
[SURFEX.ASSIM.OBS]
COBS_M = ["T2M", "HU2M", "WG2 ", "LAI", "SWE"]
NNCO = [1, 1, 0, 0, 0]
XERROBS_M = [1.0, 0.1, 0.1, 0.1, 20.0]
